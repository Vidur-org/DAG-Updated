# System Architecture Diagram

## ğŸ—ï¸ Integrated MAS-Tree System Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER QUERY                              â”‚
â”‚  "Should I invest in ADANIENSOL for 3 months?"                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TREE ORCHESTRATOR INIT                         â”‚
â”‚  - Load config (stock, levels, children)                        â”‚
â”‚  - Initialize LLM service                                       â”‚
â”‚  - Create BM25 cache                                            â”‚
â”‚  - Set MAS output path                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PHASE 1: MAS DATA GATHERING                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. Router/Planner (LLM)                                  â”‚  â”‚
â”‚  â”‚     - Analyze query intent                                â”‚  â”‚
â”‚  â”‚     - Create 3 tasks                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  2. Executor (3 Agents)                                   â”‚  â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚  â”‚     â”‚ NewsAgent                               â”‚           â”‚  â”‚
â”‚  â”‚     â”‚ - Semantic search in embeddings.json    â”‚           â”‚  â”‚
â”‚  â”‚     â”‚ - Filter by date/relevance              â”‚           â”‚  â”‚
â”‚  â”‚     â”‚ - Return news + citations               â”‚           â”‚  â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚  â”‚     â”‚ FundamentalAgent                        â”‚           â”‚  â”‚
â”‚  â”‚     â”‚ - Lookup in nifty50.json                â”‚           â”‚  â”‚
â”‚  â”‚     â”‚ - Extract financials                    â”‚           â”‚  â”‚
â”‚  â”‚     â”‚ - Return metrics + citations            â”‚           â”‚  â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚  â”‚     â”‚ InternetAgent (fallback)                â”‚           â”‚  â”‚
â”‚  â”‚     â”‚ - Calls financial_intelligence system   â”‚           â”‚  â”‚
â”‚  â”‚     â”‚ - Web search + analysis                 â”‚           â”‚  â”‚
â”‚  â”‚     â”‚ - Return comprehensive data             â”‚           â”‚  â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  3. Synthesis Report (GPT-4o-mini)                        â”‚  â”‚
â”‚  â”‚     - Combine all agent outputs                           â”‚  â”‚
â”‚  â”‚     - Generate markdown report                            â”‚  â”‚
â”‚  â”‚     - Extract key insights                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  4. Save output.json                                      â”‚  â”‚
â”‚  â”‚     {                                                     â”‚  â”‚
â”‚  â”‚       "query": "...",                                     â”‚  â”‚
â”‚  â”‚       "results": {...},                                   â”‚  â”‚
â”‚  â”‚       "final_report": "..."                               â”‚  â”‚
â”‚  â”‚     }                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 2: TREE STRUCTURE BUILDING                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. Load & Index MAS Data                                 â”‚  â”‚
â”‚  â”‚     - Read output.json                                    â”‚  â”‚
â”‚  â”‚     - Parse agent results                                 â”‚  â”‚
â”‚  â”‚     - Index into BM25 cache                               â”‚  â”‚
â”‚  â”‚     - Store 15+ searchable documents                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  2. Build Root Node (Level 0)                             â”‚  â”‚
â”‚  â”‚     Node 0: "Should I invest in STOCK?"                   â”‚  â”‚
â”‚  â”‚     - Context = Full MAS report                           â”‚  â”‚
â”‚  â”‚     - Generate 3 child questions:                         â”‚  â”‚
â”‚  â”‚       â€¢ Fundamental Analysis                              â”‚  â”‚
â”‚  â”‚       â€¢ Technical Analysis                                â”‚  â”‚
â”‚  â”‚       â€¢ Risk Assessment                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  3. BFS Expansion (Levels 1, 2, 3...)                     â”‚  â”‚
â”‚  â”‚     For each internal node:                               â”‚  â”‚
â”‚  â”‚       - LLM generates N child questions                   â”‚  â”‚
â”‚  â”‚       - LLM generates search queries                      â”‚  â”‚
â”‚  â”‚       - BM25 retrieves relevant MAS data                  â”‚  â”‚
â”‚  â”‚       - Create child nodes with context                   â”‚  â”‚
â”‚  â”‚       - Add to queue                                      â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚     Level 1 (3 nodes):                                    â”‚  â”‚
â”‚  â”‚       Node 1: Fundamental Analysis                        â”‚  â”‚
â”‚  â”‚       Node 2: Technical Analysis                          â”‚  â”‚
â”‚  â”‚       Node 3: Risk Assessment                             â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚     Level 2 (12 nodes):                                   â”‚  â”‚
â”‚  â”‚       Node 4: Financial Health (child of 1)               â”‚  â”‚
â”‚  â”‚       Node 5: Valuation Models (child of 1)               â”‚  â”‚
â”‚  â”‚       Node 6: Growth Scenarios (child of 1)               â”‚  â”‚
â”‚  â”‚       ... (9 more)                                        â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚     Level 3 (48 leaf nodes):                              â”‚  â”‚
â”‚  â”‚       Node 15: Cash Flow Quality (leaf)                   â”‚  â”‚
â”‚  â”‚       Node 16: DCF Valuation (leaf)                       â”‚  â”‚
â”‚  â”‚       ... (46 more)                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PHASE 3: ANSWER BACKPROPAGATION                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Process Bottom-Up (Level 3 â†’ Level 0)                    â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Level 3 (Leaves):                                        â”‚  â”‚
â”‚  â”‚    - Already have answers (generated during expansion)    â”‚  â”‚
â”‚  â”‚    Node 15: "Cash flow shows strong quality..."          â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Level 2 (Parents):                                       â”‚  â”‚
â”‚  â”‚    - Collect child answers                                â”‚  â”‚
â”‚  â”‚    - LLM synthesizes parent answer                        â”‚  â”‚
â”‚  â”‚    Node 4: "Financial health is strong based on..."      â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Level 1:                                                 â”‚  â”‚
â”‚  â”‚    - Aggregate Level 2 answers                            â”‚  â”‚
â”‚  â”‚    - Generate comprehensive analysis                      â”‚  â”‚
â”‚  â”‚    Node 1: "Fundamental analysis indicates..."           â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Level 0 (Root):                                          â”‚  â”‚
â”‚  â”‚    - Combine all Level 1 analyses                         â”‚  â”‚
â”‚  â”‚    - Generate final comprehensive answer                  â”‚  â”‚
â”‚  â”‚    Node 0: "Investment recommendation: ..."               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 4: INVESTMENT DECISION                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  LLM Final Decision (Structured Output)                   â”‚  â”‚
â”‚  â”‚  Input: Root node answer                                  â”‚  â”‚
â”‚  â”‚  Output:                                                  â”‚  â”‚
â”‚  â”‚    {                                                      â”‚  â”‚
â”‚  â”‚      "position": "long",                                  â”‚  â”‚
â”‚  â”‚      "confidence_level": 0.72,                            â”‚  â”‚
â”‚  â”‚      "detailed_analysis": "Based on MAS data,             â”‚  â”‚
â”‚  â”‚        fundamentals are strong..."                        â”‚  â”‚
â”‚  â”‚    }                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SAVE EXECUTION REPORT                         â”‚
â”‚  execution_report.json:                                         â”‚
â”‚    - Final investment decision                                  â”‚
â”‚    - Complete tree structure                                    â”‚
â”‚    - All node questions & answers                               â”‚
â”‚    - Execution statistics                                       â”‚
â”‚    - Adjacency lists                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             OPTIONAL: INTERACTIVE EDITING                       â”‚
â”‚  User can:                                                      â”‚
â”‚    - Edit any node's question                                   â”‚
â”‚    - System regenerates affected subtree                        â”‚
â”‚    - Backpropagates new answers                                 â”‚
â”‚    - Regenerates investment decision                            â”‚
â”‚    - Saves as execution_report_edited_N.json                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow Details

### MAS â†’ Tree Data Transfer

```
MAS output.json
    â”œâ”€ results.task_1 (NewsAgent)
    â”‚  â””â”€ Indexed as: "STOCK news articles"
    â”‚
    â”œâ”€ results.task_2 (FundamentalAgent)
    â”‚  â””â”€ Indexed as: "STOCK fundamentals financial"
    â”‚
    â”œâ”€ results.task_3 (InternetAgent)
    â”‚  â””â”€ Indexed as: "STOCK comprehensive research"
    â”‚
    â””â”€ final_report
       â””â”€ Indexed as: "STOCK comprehensive analysis investment"

Tree BM25 Cache (15+ documents)
    â†“
Used for context retrieval when building child nodes
    â†“
No new internet searches needed
    â†“
All analysis based on MAS-gathered data
```

## ğŸ”„ Node Context Inheritance

```
Root Node (Level 0)
  Context: Full MAS report (5000+ chars)
    â”‚
    â”œâ”€ Node 1 (Level 1): Fundamental Analysis
    â”‚  Context: Parent context + BM25("fundamentals") â†’ 8000 chars
    â”‚    â”‚
    â”‚    â””â”€ Node 4 (Level 2): Financial Health
    â”‚       Context: Parent context + BM25("cash flow") â†’ 10,000 chars
    â”‚         â”‚
    â”‚         â””â”€ Node 15 (Level 3 Leaf): Cash Flow Quality
    â”‚            Context: Parent context + BM25("operating cash") â†’ 12,000 chars
    â”‚            Answer: Direct analysis â†’ "Strong operating CF..."
    â”‚
    â””â”€ Node 2 (Level 1): Technical Analysis
       Context: Parent context + BM25("price technical") â†’ 8000 chars
         â””â”€ ... (similar inheritance)
```

## ğŸ“ˆ Statistics Flow

```
Total Execution:
â”œâ”€ MAS Phase: 30-60 seconds
â”‚  â”œâ”€ Router: 1 LLM call
â”‚  â”œâ”€ Agents: 3 executions
â”‚  â””â”€ Synthesis: 1 LLM call
â”‚
â”œâ”€ Tree Phase: 2-3 minutes
â”‚  â”œâ”€ Node creation: 64 nodes
â”‚  â”œâ”€ Child generation: 64 LLM calls
â”‚  â”œâ”€ BM25 searches: 100+ (all cache hits after indexing)
â”‚  â”œâ”€ Internet searches: 0 (all from MAS)
â”‚  â”œâ”€ Answer generation: 64 LLM calls
â”‚  â””â”€ Final decision: 1 LLM call
â”‚
â””â”€ Total: ~130 LLM calls, $0.50-1.00 cost
```

---

**Legend:**
- â”Œâ”€â” : Process/Phase box
- â”‚   : Data flow line
- â–¼   : Direction of flow
- â””â”€â”˜ : End of process
